<template>
    <el-row>
        <el-col :span="5">
            <p class="time">{{time}}</p>
            <el-card header="功能区" shadow="hover">
                <div class="btn-group">
                    <el-button @click="connectHandle" type="primary" size="small" class="connect">建立连接
                    </el-button>
                    <el-button type="primary" size="small" @click="$router.push({path:'/check'})">历史故障查询</el-button>
                    <el-button type="primary" size="small" @click="saveError">故障存储</el-button>
                </div>
            </el-card>
            <el-card class="select-card">
                <p><span>车站:</span></p>

                <el-select v-model="site">
                    <el-option
                        v-for="(item,index) in arr0"
                        :key="index"
                        :label="item.value"
                        :value="item.value"
                    />
                </el-select>

                <p><span>区段:</span></p>
                <el-select v-model="range">
                    <el-option
                            v-for="(item,index) in arr1"
                            :key="index"
                            :label="item.value"
                            :value="item.value"
                    />
                </el-select>

            </el-card>
            <el-card v-if="showMessageSelect" class="sub-error">
                <p><span>故障类型辅助判断区:</span></p>
                <el-select v-model="subTips" @change="subMessageChange" size="small">
                    <el-option
                        v-for="(item,index) in arr3"
                        :key="index"
                        :label="item.label"
                        :value="item.value"
                    />
                </el-select>
            </el-card>
        </el-col>
        <el-col :span="19">
            <el-card header="曲线显示" shadow="hover">
                <!-- @finish="clickHandle" -->
                <LineChart1 :width="1047" :height="400" :options="options" @chart-click="clickHandle"/>
            </el-card>

            <el-card class="result-card">
                <div class="info">
                    <p v-if="tips">状态：<span class="state" :style="changeState()"></span></p>
                    <p v-if="tips">{{ tips }}</p>
                </div>
            </el-card>

        </el-col>
    </el-row>
</template>

<script>
    import LineChart1 from "../components/LineChart1";
    export default {
        name: "Index",
        components: {LineChart1},
        data(){
            return {
                showChart: false,
                options: {
                    title: {text: "主轨出电压曲线图"},
                    xAxis: {
                        type: 'category',
                        boundaryGap: false,
                        data: ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31', '32', '33', '34', '35', '36', '37', '38', '39', '40', '41', '42', '43', '44', '45', '46', '47', '48', '49', '50', '51', '52', '53', '54', '55', '56', '57', '58', '59', '60', '61', '62', '63', '64', '65', '66', '67', '68', '69', '70', '71', '72', '73', '74', '75', '76', '77', '78', '79', '80', '81', '82', '83', '84', '85', '86', '87', '88', '89', '90', '91', '92', '93', '94', '95', '96', '97', '98', '99', '100', '101', '102', '103', '104', '105', '106', '107', '108', '109', '110', '111', '112', '113', '114', '115', '116', '117', '118', '119', '120']
                    },
                    yAxis: {
                        interval: 50,
                    },
                    series: [
                        {
                            type: 'line',
                            data: [],
                        },
                    ]
                },
                current: 0,
                tips: '',
                winH: 0,
                time: this.$moment().format('YYYY年MM月DD HH:MM:ss'),
                timeInterval: null,
                mapInterval: null,
                mockData: [
                    {
                        type: 4,
                        data: [363,366,367,369,366,365,362,361,363,366,368,400,402,405,406,401,402,405,406,408,409,411,410,407,409,407,405,403,401,400,402,405,406,407,409,408,404,403,401,399,401,403,406,407,408,402,405,406,408,405,402,406,407,409,408,406,405,402,403,361,363,365,366,364,366,367,369,370,371,368,365,363,361,364,366,368,369,370,365,363,361,364,367,401,403,406,401,405,406,405,407,409,411,412,409,407,406,405,404,401,403,405,406,403,400,402,404,364,365,366,368,369,367,363,361,360,364,365,368,366,]
                    }, {
                        type: 0,
                        data: [344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344,344]
                    }, {
                        type: 1,
                        data: [370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,30,30,30,115,200,200,200,285,360,360,360,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370,370]
                    }, {
                        type: 2,
                        data: [332, 331, 330, 327, 322, 318, 315, 311, 308, 304, 298, 294, 291, 286, 282, 279, 275, 270, 267, 263, 260, 266, 272, 278, 284, 289, 294, 299, 303, 307, 310, 313, 319, 322, 324, 328, 330, 331, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 332, 331, 332, 332, 332, 332, 332, 332, 332, 332],
                    }, {
                        type:3,
                        data:[306,305,305,305,306,305,305,305,306,305,306,305,306,305,306,305,305,305,306,305,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259,259]
                    }, {
                        type: 4,
                        data: [329,328,326,325,322,321,320,322,323,324,325,323,322,321,323,324,325,323,325,327,328,325,324,323,322,326,324,328,323,321,378,379,377,376,377,378,375,374,373,372,371,374,376,374,373,372,371,374,375,377,321,324,327,325,323,325,326,325,326,327,328,329,325,326,323,322,323,321,322,323,324,325,326,327,324,325,326,327,329,325,373,372,371,374,377,372,378,372,376,378,374,375,372,376,378,372,373,371,374,375,329,327,329,328,327,326,323,322,321,321,323,324,326,327,329,326,325,324,326,327]
                    }, {
                        type:5,
                        data:[386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,35,35,35,35,35,35,35,35,35,35,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,37,37,37,37,37,37]
                    }, {
                        type:6,
                        data:[355,355,355,355,355,355,355,355,355,355,355,355,355,355,355,355,355,355,355,354,334,313,292,270,249,228,207,186,165,183,200,217,235,252,270,288,306,325,312,298,286,272,258,245,231,218,205,215,225,235,245,255,265,275,285,295,286,278,270,262,254,247,240,233,225,230,235,241,247,253,259,265,270,275,271,267,264,261,258,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255]
                    },{
                        type: 7,
                        data: [359,359,359,360,360,359,359,359,360,359,359,359,359,359,360,360,359,360,360,359,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,561,560,560,560,560,560,560,561,560,560,561,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560,560]
                    }, {
                        type: 6,
                        data: [309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 309, 288, 267, 245, 224, 203, 182, 161, 140, 119, 137, 155, 172, 190, 208, 225, 243, 261, 279, 266, 252, 239, 224, 211, 198, 185, 172, 159, 169, 179, 189, 199, 209, 219, 229, 239, 249, 242, 235, 227, 219, 211, 203, 195, 188, 179, 185, 190, 196, 201, 207, 212, 218, 223, 229, 225, 221, 218, 215, 212, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209, 209]
                    }, {
                        type: 4,
                        data: [372, 374, 375, 377, 379, 375, 372, 371, 378, 374, 371, 332, 333, 331, 334, 335, 337, 338, 339, 336, 334, 332, 331, 330, 333, 335, 336, 337, 335, 337, 339, 335, 332, 331, 330, 372, 373, 375, 377, 373, 371, 372, 370, 372, 374, 375, 377, 331, 332, 334, 337, 338, 335, 332, 331, 330, 332, 331, 334, 336, 337, 339, 335, 332, 331, 333, 331, 330, 332, 334, 335, 372, 373, 375, 377, 378, 380, 381, 379, 376, 374, 371, 372, 332, 331, 330, 332, 334, 335, 337, 336, 337, 339, 335, 332, 330, 332, 331, 333, 335, 334, 332, 331, 333, 335, 337, 339, 340, 341, 342, 340, 339, 336, 332, 331, 330, 332, 334, 335, 331],
                    },
                    {
                        type: 7,
                        data: [344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 344, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544, 544]
                    },
                ],
                message: [
                    '正常',
                    '常见原因：列车慢行出清该区段所导致',
                    '分路不良  常见原因有  1.钢轨轨面生锈，导致传电不良。2.机车轮对沾染异物，表面形成绝缘层；3.轨道的电压调整不合理；',
                    '',
                    '常见原因：FYG引接线塞钉松动，造成区间轨道电路回路接触不实，致使电压曲线发生波动',
                    '常见原因：1.若该区段发送电压、发送网络模拟盘、接收网络模拟盘、轨入、小轨、相邻小轨电压均正常，只有该区段主柜电压突然下降，最有可能是因为衰耗盘或调整封线不良，可尝试更换衰耗盘；2.若小轨道电压升高，则是因为轨道电路主轨道断轨',
                    '该故障可能是接收端调谐单元不良所造成',
                    '常见原因：1.轨道电路未按照标调表调整；2.智能监测数值与实测电压值不符'
                ],
                arr0: [
                    {value: '济南东站'},
                    {value: '章丘北站'},
                    {value: '淄博北站'},
                    {value: '临淄北站'},
                    {value: '青州市北站'},
                    {value: '潍坊北站'},
                    {value: '高密北站'},
                    {value: '胶州北站'},
                    {value: '青岛机场站'},
                    {value: '红岛站'}
                ],
                arr1: [
                    {value: 'ⅠG'},
                    {value: 'ⅡG'},
                    {value: 'ⅢG'},
                    {value: '4G'},
                    {value: '5G'},
                    {value: '1DG'},
                    {value: '2DG'},
                    {value: '3DG'},
                ],
                arr3:[
                    {
                        label:'本区段接收端小轨出电压下降',
                        value:'接收端通道不良，可通过查看以下监测采集数据深入判断：1.接收端电缆测电压；2.主轨入电压'
                    },
                    {
                        label:'前方区段接收端小轨出电压上升',
                        value:'主轨线路不良   常见原因：补偿电容不良',
                    },
                    {
                        label:'前方区段接收端小轨出电压下降',
                        value:'发送端通道或主轨线路不良 可查看以下监测数据深入判断：1.发送端电缆测电压；2.发送供出电压；3发送电流'
                    },{

                    }
                ],
                site: null,
                range: null,
                showMessageSelect: false,
                subTips:'',
            }
        },
        watch:{
            current(newV){
                if(this.mockData[newV].type == 3){
                    this.setMessage(3)
                }
            }
        },
        mounted() {
            let that = this

            this.winH = document.documentElement.clientHeight
            this.timeInterval = setInterval(function () {
                that.time = that.$moment().format('YYYY年MM月DD HH:MM:ss')
            }, 1000)
        },
        methods: {
            connectHandle() {
                let that = this

                this.setOption(this.current)

                this.mapInterval = setInterval(function () {
                    if (that.current > that.mockData.length - 1) {
                        clearInterval(that.mapInterval)
                        that.current = 0
                    } else {
                        ++that.current
                        that.setOption(that.current)
                    }
                }, 30000)
            },
            setOption(index) {
                let temp = {...this.options}
                temp.series[0].data = this.mockData[index].data
                this.options = temp
            },
            changeState(type) {
                if (type == 0) {
                    return {background: 'green'}
                } else {
                    return {background: 'red'}
                }
            },
            setMessage(type){
                if(type==3){
                    this.showMessageSelect = true
                }else{
                    this.showMessageSelect = false
                    this.tips = this.message[type]
                }
            },
            clickHandle(param) {
                let {type} = this.mockData[this.current]
                this.setMessage(type)
                this.changeState(type)
            },
            subMessageChange(){
                this.tips = this.subTips
            },
            saveError(){
                this.$alert('已成功将当前故障信息存入故障案例库中!', {
                    confirmButtonText: '确定'
                });
            }
        },
        beforeDestroy() {
            clearInterval(this.timeInterval)
            clearInterval(this.mapInterval)
        }
    }
</script>

<style scoped>

    .info {
        min-height: 100px;
        padding: 20px 10px;
        text-align: left;
    }

    .state {
        display: inline-block;
        width: 16px;
        height: 16px;
        vertical-align: middle;
        border-radius: 50%;
    }

    .time {
        color: #3eaf7c;
        font-size: 18px;
        margin: 0;
        padding: 18px 20px;
        border: 1px solid #EBEEF5;
        border-bottom: none;
        text-align: left;
        color: #3eaf7c;
        /*background: #36495d;*/
    }

    .btn-group {
        text-align: left;
    }

    .btn-group .el-button {
        margin-left: 10px;
    }

    .btn-group .el-button + .el-button {
        margin-top: 10px;
    }

    .result-card {
        background: #ece9ea;
        /*background: #36495d;*/
        /*color: #f03163*/
    }

    .sub-error .el-select{
        width: 100%;
    }
    .sub-error p,
    .select-card p {
        line-height: 20px;
        text-align: left;
    }
</style>
